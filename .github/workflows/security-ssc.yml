name: Software Supply Chain
on:
    workflow_dispatch:
    schedule:
      - cron: '0 0 * * *'
    pull_request:

jobs:
  legitify:
    name: Legitify
    runs-on: ubuntu-latest
    environment: github
    steps:
      - name: Legitify
        uses: Legit-Labs/legitify@d64d18810d9093458f11731c3a0a36d7e573187e
        with:
          github_token: ${{ secrets.ADMIN_PAT }}
          analyze_self_only: true
          artifact_name: legitify

  chain-bench:
    name: Chain Bench
    runs-on: ubuntu-latest
    steps:
      - name: Chain Bench
        id: chain-bench
        uses: aquasecurity/chain-bench-action@cd35ac2e4470006fc9bbbbcd6c328edb61b72332
        with:
          repository-url: ${{ github.server_url }}/${{ github.repository }}
          github-token: ${{ secrets.ADMIN_PAT }}
      
      - name: Save report
        run: echo "${{ steps.chain-bench.outputs.chain-bench-result }}" > chain-bench.json
      
      - name: Upload report as GitHub artifact
        uses: actions/upload-artifact@v3
        with:
          name: chain-bench
          path: chain-bench.json
          if-no-files-found: warn
