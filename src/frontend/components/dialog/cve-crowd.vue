<template>
  <DialogDefault
    :title="integration.name"
    :avatar="integration.icon"
    @close-dialog="$emit('closeDialog')"
  >
    <template #extra-append>
      <ButtonGreenCheck
        v-if="!loading"
        :condition="cvecrowd.is_available"
        true-text="Available"
        false-text="Not Available"
      />
      <v-progress-circular
        v-if="loading"
        class="ma-3"
        :color="loadingColor"
        :size="24"
        indeterminate
      />
      <span class="me-3" />
      <v-switch
        :model-value="integration.enabled"
        color="success"
        class="mt-5"
        @click="
          integrationApi
            .update({ enabled: !integration.enabled }, integration.id)
            .then((response) => {
              integration = response;
              integration.enabled
                ? alert(
                    `${integration.name} integration has been enabled`,
                    'success',
                  )
                : alert(
                    `${integration.name} integration has been disabled`,
                    'warning',
                  );
            })
        "
      />
      <span class="me-3" />
      <ButtonLink :link="integration.reference" />
    </template>
    <template #default>
      <FormCveCrowd
        :api="api"
        :data="cvecrowd"
        @loading="(value) => (loading = value)"
        @reload-data="
          (data) => {
            cvecrowd = data;
            $emit('closeDialog');
          }
        "
      />
    </template>
  </DialogDefault>
</template>

<script setup lang="ts">
defineProps({
  integrationApi: Object,
  integration: Object,
});
defineEmits(["closeDialog"]);
const loading = ref(true);
const alert = ref(useAlert());
const api = useApi("/api/cvecrowd/", true, "CVE Crowd");
const cvecrowd = ref({ api_token: null, is_available: false });
api.get(1).then((data) => {
  cvecrowd.value = data;
  loading.value = false;
});
</script>
