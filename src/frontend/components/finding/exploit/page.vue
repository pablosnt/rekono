<template>
  <Dataset
    v-if="filtering.length > 0"
    ref="dataset"
    :api="api"
    :icon="enums.findings.Exploit.icon"
    :filtering="filtering"
    :default-parameters="defaultParameters"
    empty-head="No exploits found"
    empty-text="Run some exploit identification tool to find your first one"
    @load-data="
      (data) => {
        forceReload++;
      }
    "
  >
    <template #item="{ item }">
      <FindingExploit
        :key="forceReload > 1 ? forceReload : 1"
        :api="api"
        :finding="item"
        :defectdojo="defectdojo"
        :defectdojo-settings="defectdojoSettings"
        :hacktricks="hacktricks"
        @reload="dataset.loadData(false)"
      />
    </template>
  </Dataset>
</template>

<script setup lang="ts">
const props = defineProps({
  defaultParameters: Object,
  globalFiltering: Array,
  triageFiltering: Array,
  defectdojo: Object,
  defectdojoSettings: Object,
  hacktricks: Object,
  matchQuery: {
    type: Boolean,
    required: false,
    default: false,
  },
});
const enums = useEnums();
const filters = useFilters();
const api = useApi("/api/exploits/", true);
const dataset = ref(null);
const forceReload = ref(0);
const filtering = ref([]);
filters
  .build([
    {
      type: "autocomplete",
      label: "Sort",
      icon: "mdi-sort",
      cols: 2,
      collection: ["id", "title", "reference"],
      fieldValue: "id",
      fieldTitle: "name",
      key: "ordering",
      defaultValue: "-id",
    },
  ])
  .then((orderFilters) => {
    filtering.value = props.globalFiltering.concat(orderFilters);
  });
</script>
